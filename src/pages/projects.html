---
menu: base.lists
title: Progetti
page-header: Pannello
layout-sidebar: true
layout-navbar-transparent: true
layout-hide-topbar: true
page-header-actions: buttons
---

<!-- src/pages/_includes/parts/modals/report.html -->

<div class="row row-cards">

		<div class="row row-cards">
			<div class="col-12">
				{% include asimov_cards/projects-list.html offset=8 checkbox=true hoverable=true title="Progetti"   %}
			</div>
		</div>
</div>

<script>
	const accessToken = sessionStorage.getItem('access_token');

		
	async function deleteProject(projectName){
		try {
            const response = await fetch(`{{ site.data.endpoint[0].host }}/users/me/projects/?project_name=${projectName}`, {
                method: 'DELETE',
                headers: {
                    'Accept': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded', // Commented out as it seems not needed for a GET request
                    'Authorization': `Bearer ${accessToken}`,
                },
            });

            // Check if the request was successful
            if (!response.ok) {
                // Check if the error is related to authentication (401 Unauthorized)
                if (response.status === 401) {
                    window.location.href = '/sign-in.html';
                    throw new Error('Authentication error: Unauthorized');
                }
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const outcome = await response.json();
            // If successful, update your items
            console.log(`Successfully deleted item ${projectName}`)
        } catch (error) {
            console.error('Error:', error.message);
        }
    }

    async function fetchData() {
        try {
            const response = await fetch('{{ site.data.endpoint[0].host }}/users/me/projects/', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    // 'Content-Type': 'application/x-www-form-urlencoded', // Commented out as it seems not needed for a GET request
                    'Authorization': `Bearer ${accessToken}`,
                },
            });

            // Check if the request was successful
            if (!response.ok) {
                // Check if the error is related to authentication (401 Unauthorized)
                if (response.status === 401) {
                    window.location.href = '/sign-in.html';
                    throw new Error('Authentication error: Unauthorized');
                }
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            // If successful, update your items
            updateItems(data);
        } catch (error) {
            console.error('Error:', error.message);
        }
    }

    fetchData();



	// Function to update items on the page
	function updateItems(data) {
		// Select the container where you want to add the items
		var listContainer = document.getElementById('projects_list');

		// Clear the container
		while (listContainer.children.length > 1) {  // Header
			listContainer.removeChild(listContainer.lastChild);
		}

		// Check if data is empty and handle accordingly
		if (data.length === 0) {
			data = ['Nessun progetto presente']
		}

		// Loop through the data and create new items
		data.forEach(item => {
			// Assuming `item` has properties: name, detail, badgeColor, and actionLink
			var rowTemplate = document.getElementById('item_template').cloneNode(true);
			rowTemplate.style.display = ''; // Make it visible
			rowTemplate.removeAttribute('id');; // Remove the ID to avoid duplicate IDs

            // Update project name
            var projectName = rowTemplate.querySelector('.text-reset');
            projectName.textContent = item; // Set the project name

			// Update project link
			var projectLink = rowTemplate.querySelector('[data-id="projectButton"]');
            projectLink.href = `/annotate.html?projectName=${item}`;
            
			// Update functional buttons
			var deleteButton = rowTemplate.querySelector('[data-id="deleteButton"]');
            deleteButton.addEventListener('click', function() {deleteProject(item)});
			

            // Append the newly created row to the list container
            listContainer.appendChild(rowTemplate);

		});
	}


</script>