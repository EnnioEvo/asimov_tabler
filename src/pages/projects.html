---
menu: base.lists
title: Progetti
page-header: Pannello
layout-sidebar: true
layout-navbar-transparent: true
layout-hide-topbar: true
page-header-actions: buttons
---

<!-- src/pages/_includes/parts/modals/report.html -->

<div class="row row-cards">

		<div class="row row-cards">
			<div class="col-12">
				{% include asimov_cards/projects-list.html offset=8 checkbox=true hoverable=true title="Progetti"   %}
			</div>
		</div>
</div>

<script>
	const accessToken = sessionStorage.getItem('access_token');
	// Fetch data from your API
	fetch('{{ site.data.endpoint[0].host }}/users/me/projects/', {
		method: 'GET',
		headers: {
			'Accept': 'application/json',
			// 'Content-Type': 'application/x-www-form-urlencoded',
			'Authorization': `Bearer ${accessToken}`,
		},
	})
		.then(response => {
			// Check if the request was successful
			if (!response.ok) {
				// Check if the error is related to authentication (401 Unauthorized)
				if (response.status === 401) {
					window.location.href = '/sign-in.html';
					throw new Error('Authentication error: Unauthorized');
				}
				throw new Error(`HTTP error! status: ${response.status}`);
			}
			return response.json();
		})
		.then(data => {
			// If successful, update your items
			updateItems(data);
		})
		.catch(error => {
			console.error('Error:', error.message);
		});

	// Function to update items on the page
	function updateItems(data) {
		// Select the container where you want to add the items
		var listContainer = document.getElementById('projects_list');

		// Clear the container
		while (listContainer.children.length > 1) {  // Header
			listContainer.removeChild(listContainer.lastChild);
		}

		// Check if data is empty and handle accordingly
		if (data.length === 0) {
			data = ['Nessun progetto presente']
		}

		// Loop through the data and create new items
		data.forEach(item => {
			// Assuming `item` has properties: name, detail, badgeColor, and actionLink
			var rowTemplate = document.getElementById('item_template').cloneNode(true);
			rowTemplate.style.display = ''; // Make it visible
			rowTemplate.id = ''; // Remove the ID to avoid duplicate IDs
            rowTemplate.href = `/annotate.html?=${item}`;

            // Update project name and link
            var projectNameLink = rowTemplate.querySelector('.text-reset');
            projectNameLink.textContent = item; // Set the project name
            
            // Append the newly created row to the list container
            listContainer.appendChild(rowTemplate);

		});
	}

</script>